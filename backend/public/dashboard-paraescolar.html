<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Dashboard Paraescolar</title>
<link rel="stylesheet" href="/style.css">


</head>

<body>
<nav>
<div class="nav-logo">
<img alt="Logo" src="/logo.png"/>
</div>
<div class="nav-links">
<a href="index.html">Inicio</a>
<a href="consultar-grupo.html">Consultar grupo</a>

<a href="login.html">Iniciar sesiÃ³n</a>
</div>
</nav>
<div class="container">

<h2>ðŸ“Š Dashboard Paraescolar</h2>

<!-- ðŸ“¤ CARGAR EXCEL -->
<h3>Cargar Excel de Alumnos</h3>

<form id="excelForm" enctype="multipart/form-data">
  <input type="file" name="excel" accept=".xlsx,.xls" required>
  <button type="submit">Subir Excel</button>
</form>

<hr>

<!-- ðŸ“¥ EXPORTAR -->
<h3>Exportar Registros</h3>

<button onclick="descargarExcel()">Descargar Excel</button>


  <hr>

<h3>ðŸ“Š Cupos por Paraescolar</h3>

<button onclick="cargarEstadisticas()">Actualizar conteo</button>

<table border="1" width="100%" style="margin-top:10px;">
  <thead>
    <tr>
      <th>Paraescolar</th>
      <th>Total inscritos</th>
      <th>Disponibles</th>
    </tr>
  </thead>
  <tbody id="tablaStats"></tbody>
</table>



</div>
<script>
async function descargarExcel() {
  try {
    const resp = await fetch("/api/paraescolar/exportar");

    if (!resp.ok) {
      alert("Error al generar el Excel");
      return;
    }

    const blob = await resp.blob();
    const url = window.URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "paraescolares.CSV";
    document.body.appendChild(a);
    a.click();

    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);

  } catch (error) {
    console.error(error);
    alert("Error al descargar archivo");
  }
}
</script>

<script>
document.getElementById("excelForm").addEventListener("submit", async e => {
  e.preventDefault();

  const formData = new FormData(e.target);

  try {
    const resp = await fetch("/api/paraescolar/cargar-excel", {
      method: "POST",
      body: formData
    });

    const data = await resp.json();

    if (data.ok) {
      alert("âœ… Excel cargado correctamente");
    } else {
      alert("âŒ Error al cargar Excel");
    }

  } catch (error) {
    console.error(error);
    alert("Error de conexiÃ³n");
  }
});


async function cargarEstadisticas() {
  try {
    const resp = await fetch("/api/paraescolar/estadisticas");
    const data = await resp.json();

    const tbody = document.getElementById("tablaStats");
    tbody.innerHTML = "";

    data.forEach(item => {
      const disponibles = 50 - item.total;

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${item._id}</td>
        <td>${item.total}</td>
        <td>${disponibles}</td>
      `;
      tbody.appendChild(tr);
    });

  } catch (error) {
    console.error(error);
    alert("Error al cargar estadÃ­sticas");
  }
}


  
</script>

</body>
</html>
