<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro Online Alumno</title>
  <link rel="stylesheet" href="/style.css">
  <link rel="icon" href="/favicon.ico">
</head>

<body>

<!-- NAV igual a tu sistema -->
<nav>
  <div class="nav-logo">
    <img src="/logo.png" alt="Logo">
  </div>
  <div class="nav-links">
    <a href="index.html">Inicio</a>
    <a href="login.html">Iniciar sesi√≥n</a>
  </div>
</nav>

<h2>üìù Registro Nuevo Alumno</h2>

<form id="registroRapido">

  <!-- ================= CURP ================= -->
  <fieldset>
    <legend>Validaci√≥n por CURP</legend>

    <input id="curpBuscar"
           placeholder="Ingresa CURP (18 caracteres)"
           maxlength="18"
           required>

    <button type="button" onclick="buscarCurp()">Validar CURP</button>
  </fieldset>


  <!-- ================= DATOS B√ÅSICOS ================= -->
  <fieldset>
    <legend>Datos B√°sicos</legend>

    <input id="nombre" name="nombre" placeholder="Nombre completo" required>
    <input id="telefono" name="telefono" placeholder="Tel√©fono" required>
    <input id="correo" name="correo" type="email" placeholder="Correo" required>

    <select id="turno" name="turno" required>
      <option value="">Selecciona turno</option>
      <option>Matutino</option>
      <option>Vespertino</option>
    </select>

    <select id="paraescolar" name="paraescolar" required>
      <option value="">Selecciona paraescolar</option>
      <option>FUTBOL</option>
      <option>BASQUETBOL</option>
      <option>VOLEIBOL</option>
      <option>DANZA</option>
      <option>BANDA DE GUERRA</option>
      <option>AJEDREZ</option>
      <option>PINTURA</option>
      <option>M√öSICA</option>
    </select>
  </fieldset>

  <button type="submit">Guardar Registro</button>

</form>


<!-- ================= SCRIPT ================= -->
<script>
let alumnoExistente = null;

/* ===== VALIDAR FORMATO CURP ===== */
function validarCURP(curp){
  const regex = /^[A-Z]{4}\d{6}[HM][A-Z]{5}[A-Z0-9]\d$/;
  return regex.test(curp);
}

/* ===== BUSCAR CURP ===== */
async function buscarCurp(){

  const curp = document.getElementById("curpBuscar").value.toUpperCase().trim();

  if(!validarCURP(curp)){
    alert("‚ùå CURP inv√°lida");
    return;
  }

  const resp = await fetch(`/api/alumno/curp/${curp}`);
  const data = await resp.json();

  if(data.encontrado){
    alumnoExistente = data.alumno;

    nombre.value = alumnoExistente.nombre || "";
    turno.value = alumnoExistente.turno || "";

    alert("‚úÖ Alumno existente, datos cargados");
  }else{
    alert("üÜï Alumno nuevo, captura tus datos");
  }
}

/* ===== GUARDAR ===== */
document.getElementById("registroRapido").addEventListener("submit", async e => {
  e.preventDefault();

  const datos = {
    curp: curpBuscar.value.toUpperCase(),
    nombre: nombre.value,
    telefono: telefono.value,
    correo: correo.value,
    turno: turno.value,
    paraescolar: paraescolar.value
  };

  const resp = await fetch("/api/registro-online", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(datos)
  });

  const result = await resp.json();

  if(result.ok){
    alert("üéâ Registro guardado correctamente");
    location.reload();
  }else{
    alert("‚ùå Error al guardar");
  }
});
</script>

</body>
</html>
