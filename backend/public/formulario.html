<!DOCTYPE html>

<html lang="es">
<head>
<link href="/style.css" rel="stylesheet"/>
<link href="/favicon.ico" rel="icon" type="image/x-icon"/>
<meta charset="utf-8"/>
<title>Formulario de Alumno</title>

</head>
<body>
<nav>
<div class="nav-logo">
<img alt="Logo" src="/logo.png"/>
</div>
<div class="nav-links">
<a href="index.html">Inicio</a>
<a href="consultar-grupo.html">Consultar grupo</a>

<a href="login.html">Iniciar sesión</a>
</div>
</nav>
<h2>Formulario de Registro</h2>
<form id="registroForm">
<!-- Fieldsets integrados -->
<fieldset>
<legend>Datos del Alumno</legend>
  
<div class="row-5">
  <input id="nombres" name="nombres" placeholder="Nombres" required type="text"/>

  <input id="primer_apellido" name="primer_apellido" placeholder="Primer Apellido" required type="text"/>

  <input id="segundo_apellido" name="segundo_apellido" placeholder="Segundo Apellido" required type="text"/>

  <input id="curp" name="curp" placeholder="CURP" maxlength="18" required type="text"/>

  <button type="button" id="btnValidarCurp" class="btn-validar">
    Validar
  </button>
</div>



  
<div>
  <label for="fecha_nacimiento">Fecha de Nacimiento</label>
  <input id="fecha_nacimiento" name="fecha_nacimiento" required type="date"/>
</div>

<div>
  <label for="edad">Edad (solo número en años)</label>
  <input id="edad" name="edad" type="number" placeholder="Ej. 14" min="13" max="25" required>
</div>


<div>
  <label for="sexo">Sexo</label>
  <select id="sexo" name="sexo" required>
    <option value="">Selecciona sexo</option>
    <option value="femenino">Femenino</option>
    <option value="masculino">Masculino</option>
  </select>
</div>

<div>
  <label for="primera_opcion">1ERA OPCIÓN</label>
  <select id="primera_opcion" name="primera_opcion" required>
    <option value="">Cuál fue tu 1era opción</option>
    <option value="A Y B">A Y B</option>
    <option value="PROGRAMACIÓN">PROGRAMACIÓN</option>
    <option value="GESTIÓN E INNOVACIÓN TURÍSTICA">GESTIÓN E INNOVACIÓN TURÍSTICA</option>
    <option value="VENTAS">VENTAS</option>
  </select>
</div>

<div>
  <label for="segunda_opcion">2DA OPCIÓN</label>
  <select id="segunda_opcion" name="segunda_opcion" required>
    <option value="">Cuál fue tu 2da opción</option>
    <option value="A Y B">A Y B</option>
    <option value="PROGRAMACIÓN">PROGRAMACIÓN</option>
    <option value="GESTIÓN E INNOVACIÓN TURÍSTICA">GESTIÓN E INNOVACIÓN TURÍSTICA</option>
    <option value="VENTAS">VENTAS</option>
  </select>
</div>

<div>
  <label for="tercera_opcion">3ERA OPCIÓN</label>
  <select id="tercera_opcion" name="tercera_opcion" required>
    <option value="">Cuál fue tu 3era opción</option>
    <option value="A Y B">A Y B</option>
    <option value="PROGRAMACIÓN">PROGRAMACIÓN</option>
    <option value="GESTIÓN E INNOVACIÓN TURÍSTICA">GESTIÓN E INNOVACIÓN TURÍSTICA</option>
    <option value="VENTAS">VENTAS</option>
  </select>
</div>

<div>
  <label for="cuarta_opcion">4TA OPCIÓN</label>
  <select id="cuarta_opcion" name="cuarta_opcion" required>
    <option value="">Cuál fue tu 4ta opción</option>
    <option value="A Y B">A Y B</option>
    <option value="PROGRAMACIÓN">PROGRAMACIÓN</option>
    <option value="GESTIÓN E INNOVACIÓN TURÍSTICA">GESTIÓN E INNOVACIÓN TURÍSTICA</option>
    <option value="VENTAS">VENTAS</option>
  </select>
</div>





<div>
  <label for="nacionalidad">Nacionalidad</label>
  <select id="nacionalidad" name="nacionalidad" required>
    <option value="">Selecciona Nacionalidad</option>
    <option value="Mexicano">Mexicano</option>
    <option value="Extranjero">Extranjero</option>
  </select>
</div>

<div>
  <label for="pais_extranjero">País (si es extranjero)</label>
  <input id="pais_extranjero" name="pais_extranjero" placeholder="País (si es extranjero)" type="text"/>
</div>

<div>
  <label for="estado_civil">Estado Civil</label>
  <select id="estado_civil" name="estado_civil" required>
    <option value="">Selecciona Estado Civil</option>
    <option value="Soltero">Soltero</option>
    <option value="Casado">Casado</option>
    <option value="Unión libre">Unión libre</option>
    <option value="Otro">Otro</option>
  </select>
</div>






<!-- Bloque de Estado/Municipio/Ciudad de nacimiento -->
<div>
  <label for="estado_nacimiento">Estado de nacimiento</label>
  <select id="estado_nacimiento" name="estado_nacimiento" required>
    <option value="">-- Selecciona Estado --</option>
  </select>
</div>

<div>
  <label for="municipio_nacimiento">Municipio de nacimiento</label>
  <select id="municipio_nacimiento" name="municipio_nacimiento" required disabled>
    <option value="">-- Selecciona Municipio --</option>
  </select>
</div>

<div>
  <label for="ciudad_nacimiento">Ciudad de nacimiento</label>
  <select id="ciudad_nacimiento" name="ciudad_nacimiento" required disabled>
    <option value="">-- Selecciona Ciudad --</option>
  </select>
</div>

<!-- Inputs ocultos para MongoDB -->
<input name="estado_codigo" type="hidden"/>
<input name="municipio_codigo" type="hidden"/>
<input name="ciudad_codigo" type="hidden"/>
</fieldset>
<fieldset>
<legend>DATOS GENERALES DEL ALUMNO</legend>
<input name="colonia" placeholder="SMZ, COLONIA, FRACCIONAMIENTO" type="text"/>
<input name="domicilio" placeholder=" CALLE MZ LT EDIFICIO DEPTO" type="text"/>
<input name="codigo_postal" placeholder="CÓDIGO POSTAL" type="text"/>
<input name="telefono_alumno" placeholder="TÉLEFONO DEL ALUMNO" type="number"/>
<input name="correo_alumno" placeholder="CORREO" required="" type="email"/>
<input name="tipo_sangre" placeholder="TIPO DE SANGRE" type="text"/>
<input name="contacto_emergencia_nombre" placeholder="CONTACTO DE EMERGENCIA-NOMBRE" type="text"/>
<input name="contacto_emergencia_telefono" placeholder="CONTACTO DE EMERGENCIA- TELÉFONO" type="number"/>

<div>
  <label for="habla_lengua_indigena_respuesta">¿Habla lengua indígena?</label>
  <select id="habla_lengua_indigena_respuesta" name="habla_lengua_indigena_respuesta" required>
    <option value="">¿Habla lengua indígena? (Sí/No)</option>
    <option value="si">Sí</option>
    <option value="no">No</option>
  </select>
</div>

<div>
  <label for="habla_lengua_indigena_cual">¿Cuál lengua?</label>
  <input id="habla_lengua_indigena_cual" name="habla_lengua_indigena_cual" placeholder="¿Cuál lengua?" type="text"/>
</div>

  
<!-- Selección de lugar de nacimiento en DATOS GENERALES -->
<div>
  <label for="estado_nacimiento_general">Estado de Residencia</label>
  <select id="estado_nacimiento_general" name="estado_nacimiento_general" required>
    <option value="">-- Selecciona Estado --</option>
    <!-- Opciones dinámicas aquí -->
  </select>
</div>

<div>
  <label for="municipio_nacimiento_general">Municipio de Residencia</label>
  <select id="municipio_nacimiento_general" name="municipio_nacimiento_general" required disabled>
    <option value="">-- Selecciona Municipio --</option>
  </select>
</div>

<div>
  <label for="ciudad_nacimiento_general">Ciudad de Residencia</label>
  <select id="ciudad_nacimiento_general" name="ciudad_nacimiento_general" required disabled>
    <option value="">-- Selecciona Ciudad --</option>
  </select>
</div>

<!-- Inputs ocultos para guardar claves -->
<input type="hidden" name="estado_codigo_general" />
<input type="hidden" name="municipio_codigo_general" />
<input type="hidden" name="ciudad_codigo_general" />

  
</fieldset>
  
<fieldset> 
<legend>Secundaria de Origen</legend>
<input name="nombre_secundaria" placeholder="Nombre de Secundaria" type="text"/>
<select name="regimen" required="">
<option value="">Selecciona régimen</option>
<option value="publica">Pública</option>
<option value="privada">Privada</option>
</select>
<input name="promedio_general" placeholder="Promedio General" step="0.01" type="number"/>
<select name="modalidad" required="">
<option value="">Selecciona modalidad</option>
<option value="general">General</option>
<option value="tecnica">Técnica</option>
<option value="abierta">Abierta</option>
<option value="telesecundaria">Telesecundaria</option>
<option value="ceneval">CENEVAL</option>
<option value="inea">INEA</option>
<option value="modular">Modular</option>
  <option value="otro">Otro</option>
</select>
</fieldset>
<fieldset>
<legend>Tutor Responsable</legend>
<input name="nombre_padre" placeholder="Nombre del Padre" type="text"/>
<input name="telefono_padre" placeholder="Teléfono del Padre" type="number"/>
<input name="nombre_madre" placeholder="Nombre de la Madre" type="text"/>
<input name="telefono_madre" placeholder="Teléfono de la Madre" type="number"/>
<select name="vive_con" required="">
<option value="">¿Con quién vive?</option>
<option value="padres">Padres</option>
<option value="mama">Mamá</option>
<option value="papa">Papá</option>
<option value="abuelos">Abuelos</option>
<option value="tios">Tíos</option>
</select>
 
</fieldset>
 
<button type="submit">Guardar</button>
<div id="pdfLink" style="margin-top: 20px;"></div>
</form>




<script>
  const opciones = ["A Y B", "PROGRAMACIÓN", "GESTIÓN E INNOVACIÓN TURÍSTICA", "VENTAS"];
  const selects = [
    document.getElementById('primera_opcion'),
    document.getElementById('segunda_opcion'),
    document.getElementById('tercera_opcion'),
    document.getElementById('cuarta_opcion')
  ];
  function actualizarOpciones() {
    const seleccionados = selects.map(select => select.value);
    selects.forEach(select => {
      const valorActual = select.value;
      select.innerHTML = '<option value="">Selecciona opción</option>';
      opciones.forEach(opcion => {
        if (!seleccionados.includes(opcion) || opcion === valorActual) {
          const option = document.createElement('option');
          option.value = opcion;
          option.textContent = opcion;
          if (opcion === valorActual) option.selected = true;
          select.appendChild(option);
        }
      });
    });
  }
  selects.forEach(select => {
    select.addEventListener('change', actualizarOpciones);
  });
</script>

<script>
/* =========================================
   VALIDAR CURP + AUTOCARGAR DESDE PADRÓN
========================================= */

const inputCurp = document.querySelector('input[name="curp"]');
const inputNombres = document.querySelector('input[name="nombres"]');
const inputAp1 = document.querySelector('input[name="primer_apellido"]');
const inputAp2 = document.querySelector('input[name="segundo_apellido"]');

inputCurp.addEventListener("blur", async () => {

  const curp = inputCurp.value.trim().toUpperCase();

  if(curp.length !== 18) return;

  // regex CURP real
  const regex = /^[A-Z]{4}[0-9]{6}[HM][A-Z]{5}[A-Z0-9]{2}$/;

  if(!regex.test(curp)){
    alert("CURP inválida");
    return;
  }

  try{

    const resp = await fetch(`/api/padron/${curp}`);
    const alumno = await resp.json();

    if(!alumno){
      alert("⚠️ CURP no encontrada en padrón");
      return;
    }

    // AUTOLLENAR
    inputNombres.value = alumno.nombres || "";
    inputAp1.value = alumno.primer_apellido || "";
    inputAp2.value = alumno.segundo_apellido || "";

    // bloquear edición
    inputNombres.readOnly = true;
    inputAp1.readOnly = true;
    inputAp2.readOnly = true;

  }catch(err){
    console.error(err);
    alert("Error consultando padrón");
  }

});
</script>


  
<script defer="" src="scripts.js"></script>
</body>
</html>

